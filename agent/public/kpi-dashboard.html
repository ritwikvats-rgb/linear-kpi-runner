<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KPI Dashboard - DL & Feature Level</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg-primary: #0f0f1a;
      --bg-secondary: #1a1a2e;
      --bg-tertiary: #16213e;
      --glass-bg: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.5);
      --accent-blue: #6366f1;
      --accent-purple: #8b5cf6;
      --accent-pink: #ec4899;
      --accent-green: #22c55e;
      --accent-orange: #f59e0b;
      --accent-teal: #14b8a6;
      --status-success: #4ade80;
      --status-warning: #fbbf24;
      --status-error: #f87171;
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image:
        radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    /* Navigation */
    .nav-bar {
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 32px;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
    }

    .nav-brand {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .nav-brand svg {
      width: 28px;
      height: 28px;
      color: var(--accent-blue);
    }

    .nav-links {
      display: flex;
      gap: 8px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      color: var(--text-secondary);
      text-decoration: none;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }

    .nav-link svg {
      width: 18px;
      height: 18px;
    }

    .nav-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: var(--status-success);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Tab Navigation */
    .tab-container {
      position: relative;
      z-index: 1;
      padding: 24px 32px 0;
    }

    .tab-nav {
      display: flex;
      gap: 4px;
      background: var(--glass-bg);
      padding: 4px;
      border-radius: 12px;
      width: fit-content;
    }

    .tab-btn {
      padding: 12px 24px;
      background: transparent;
      border: none;
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tab-btn:hover {
      color: var(--text-primary);
      background: rgba(255, 255, 255, 0.05);
    }

    .tab-btn.active {
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      color: white;
    }

    .tab-btn svg {
      width: 18px;
      height: 18px;
    }

    /* Tab Content */
    .tab-content {
      display: none;
      position: relative;
      z-index: 1;
      padding: 24px 32px;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Section Headers */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .section-title .badge {
      font-size: 0.75rem;
      padding: 4px 12px;
      background: rgba(99, 102, 241, 0.2);
      color: var(--accent-blue);
      border-radius: 6px;
      font-weight: 500;
    }

    .section-subtitle {
      color: var(--text-secondary);
      font-size: 0.875rem;
      margin-top: 4px;
    }

    /* Hero Metrics */
    .hero-metrics {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .hero-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      transition: all 0.2s;
    }

    .hero-card:hover {
      transform: translateY(-4px);
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
    }

    .hero-card.highlight {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
      border-color: rgba(99, 102, 241, 0.3);
    }

    .hero-value {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-pink));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-card.highlight .hero-value {
      background: linear-gradient(135deg, var(--accent-green), var(--accent-teal));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-top: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .hero-sublabel {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Charts Grid */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-bottom: 24px;
    }

    .chart-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 24px;
      transition: all 0.2s;
    }

    .chart-card:hover {
      transform: translateY(-4px);
      border-color: rgba(255, 255, 255, 0.15);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    }

    .chart-card.wide {
      grid-column: span 2;
    }

    .chart-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .chart-title {
      font-size: 1rem;
      font-weight: 600;
    }

    .chart-badge {
      font-size: 0.75rem;
      padding: 4px 8px;
      background: rgba(99, 102, 241, 0.2);
      color: var(--accent-blue);
      border-radius: 6px;
    }

    .chart-container {
      height: 300px;
      position: relative;
    }

    .chart-card.wide .chart-container {
      height: 350px;
    }

    /* Data Tables */
    .data-table-container {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 24px;
      overflow-x: auto;
      margin-bottom: 24px;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th,
    .data-table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--glass-border);
    }

    .data-table th {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      background: rgba(255, 255, 255, 0.02);
    }

    .data-table td {
      font-size: 0.875rem;
    }

    .data-table tr:last-child td {
      border-bottom: none;
    }

    .data-table tr:hover td {
      background: rgba(255, 255, 255, 0.03);
    }

    .data-table .total-row {
      font-weight: 600;
      background: rgba(99, 102, 241, 0.1);
    }

    .data-table .total-row td {
      border-top: 2px solid var(--accent-blue);
    }

    /* Status Badges */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .status-badge.success {
      background: rgba(34, 197, 94, 0.2);
      color: var(--accent-green);
    }

    .status-badge.warning {
      background: rgba(245, 158, 11, 0.2);
      color: var(--accent-orange);
    }

    .status-badge.error {
      background: rgba(239, 68, 68, 0.2);
      color: var(--status-error);
    }

    .status-badge.info {
      background: rgba(99, 102, 241, 0.2);
      color: var(--accent-blue);
    }

    /* Progress Bar */
    .progress-bar {
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      min-width: 100px;
    }

    .progress-bar .fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .progress-bar .fill.green { background: linear-gradient(90deg, var(--accent-green), var(--accent-teal)); }
    .progress-bar .fill.orange { background: linear-gradient(90deg, var(--accent-orange), #fbbf24); }
    .progress-bar .fill.red { background: linear-gradient(90deg, var(--status-error), var(--accent-pink)); }
    .progress-bar .fill.blue { background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)); }

    /* Pod Colors */
    .pod-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
    }

    .pod-fts { background: #6366f1; }
    .pod-gts { background: #8b5cf6; }
    .pod-cc { background: #ec4899; }
    .pod-ts { background: #14b8a6; }
    .pod-platform { background: #f59e0b; }
    .pod-gr { background: #22c55e; }

    /* AI Insights */
    .insights-panel {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .insights-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .insights-title svg {
      width: 20px;
      height: 20px;
      color: var(--accent-green);
    }

    .insights-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    .insight-card {
      padding: 16px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      border-left: 3px solid var(--accent-blue);
    }

    .insight-card.highlight { border-left-color: var(--accent-green); }
    .insight-card.warning { border-left-color: var(--accent-orange); }
    .insight-card.trend { border-left-color: var(--accent-blue); }

    .insight-label {
      font-size: 0.625rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .insight-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Footer */
    .footer {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 32px;
      border-top: 1px solid var(--glass-border);
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Loading */
    .loading-spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid var(--glass-border);
      border-top-color: var(--accent-blue);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .charts-grid { grid-template-columns: 1fr; }
      .chart-card.wide { grid-column: span 1; }
      .insights-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .hero-metrics { grid-template-columns: repeat(2, 1fr); }
      .insights-grid { grid-template-columns: 1fr; }
      .nav-bar { padding: 12px 16px; }
      .tab-container, .tab-content { padding-left: 16px; padding-right: 16px; }
    }

    @media (max-width: 480px) {
      .hero-metrics { grid-template-columns: 1fr; }
      .tab-btn { padding: 10px 16px; font-size: 0.8rem; }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="nav-bar">
    <div class="nav-brand">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 3v18h18"/>
        <path d="M18 17V9"/>
        <path d="M13 17V5"/>
        <path d="M8 17v-3"/>
      </svg>
      <span>KPI Dashboard</span>
    </div>
    <div class="nav-links">
      <a href="index.html" class="nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>
        Chat
      </a>
      <a href="charts.html" class="nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 20V10"/>
          <path d="M12 20V4"/>
          <path d="M6 20v-6"/>
        </svg>
        Charts
      </a>
    </div>
    <div class="nav-status">
      <span class="status-dot"></span>
      <span>Live Data</span>
    </div>
  </nav>

  <!-- Tab Navigation -->
  <div class="tab-container">
    <div class="tab-nav">
      <button class="tab-btn active" data-tab="dl-kpi">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
        DL-level Weekly KPI (C2)
      </button>
      <button class="tab-btn" data-tab="feature-kpi">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <line x1="3" y1="9" x2="21" y2="9"/>
          <line x1="9" y1="21" x2="9" y2="9"/>
        </svg>
        Feature-level KPI
      </button>
    </div>
  </div>

  <!-- DL-Level Weekly KPI Tab -->
  <div class="tab-content active" id="dl-kpi">
    <div class="section-header">
      <div>
        <h1 class="section-title">
          DEL Metrics
          <span class="badge" id="dlCycleBadge">C2</span>
        </h1>
        <p class="section-subtitle">Cycle 2 baseline and weekly tracking (Jan 20 - Feb 2, 2026)</p>
      </div>
    </div>

    <!-- DEL Hero Metrics -->
    <div class="hero-metrics" id="dlHeroMetrics">
      <div class="hero-card">
        <div class="hero-value" id="dlDeliveryPct">--</div>
        <div class="hero-label">Delivery Rate</div>
        <div class="hero-sublabel" id="dlDeliveryDetail">Loading...</div>
      </div>
      <div class="hero-card">
        <div class="hero-value" id="dlCommitted">--</div>
        <div class="hero-label">Committed</div>
        <div class="hero-sublabel">C2 Baseline</div>
      </div>
      <div class="hero-card">
        <div class="hero-value" id="dlCompleted">--</div>
        <div class="hero-label">Completed</div>
        <div class="hero-sublabel" id="dlCompletedDetail">Done this cycle</div>
      </div>
      <div class="hero-card highlight">
        <div class="hero-value" id="dlPending">--</div>
        <div class="hero-label">Pending</div>
        <div class="hero-sublabel">To be delivered</div>
      </div>
    </div>

    <!-- DEL Charts -->
    <div class="charts-grid">
      <div class="chart-card">
        <div class="chart-header">
          <h2 class="chart-title">Delivery % by Pod</h2>
          <span class="chart-badge">C2</span>
        </div>
        <div class="chart-container">
          <canvas id="dlDeliveryChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header">
          <h2 class="chart-title">Committed vs Completed</h2>
          <span class="chart-badge">All Pods</span>
        </div>
        <div class="chart-container">
          <canvas id="dlComparisonChart"></canvas>
        </div>
      </div>
    </div>

    <!-- DEL Table -->
    <div class="data-table-container">
      <div class="chart-header">
        <h2 class="chart-title">Pod-wise DEL Breakdown (C2 Baseline)</h2>
      </div>
      <table class="data-table" id="dlTable">
        <thead>
          <tr>
            <th>Pod</th>
            <th>Committed</th>
            <th>Completed</th>
            <th>Pending</th>
            <th>Delivery %</th>
            <th>Progress</th>
          </tr>
        </thead>
        <tbody id="dlTableBody">
          <tr><td colspan="6" style="text-align: center; padding: 40px;"><div class="loading-spinner"></div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- Cycle Trend -->
    <div class="chart-card wide">
      <div class="chart-header">
        <h2 class="chart-title">DEL Delivery Trend Across Cycles</h2>
        <span class="chart-badge">C1 - C6</span>
      </div>
      <div class="chart-container">
        <canvas id="dlTrendChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Feature-Level KPI Tab -->
  <div class="tab-content" id="feature-kpi">
    <div class="section-header">
      <div>
        <h1 class="section-title">
          Feature Execution
          <span class="badge">All Pods</span>
        </h1>
        <p class="section-subtitle">Feature-level analysis across the entire org/pods</p>
      </div>
    </div>

    <!-- Feature Hero Metrics -->
    <div class="hero-metrics" id="featureHeroMetrics">
      <div class="hero-card">
        <div class="hero-value" id="featureTotal">--</div>
        <div class="hero-label">Total Features</div>
        <div class="hero-sublabel">Planned across org</div>
      </div>
      <div class="hero-card highlight">
        <div class="hero-value" id="featureDone">--</div>
        <div class="hero-label">Done</div>
        <div class="hero-sublabel" id="featureDonePct">--</div>
      </div>
      <div class="hero-card">
        <div class="hero-value" id="featureInFlight">--</div>
        <div class="hero-label">In Flight</div>
        <div class="hero-sublabel">Active work</div>
      </div>
      <div class="hero-card">
        <div class="hero-value" id="featureNotStarted">--</div>
        <div class="hero-label">Not Started</div>
        <div class="hero-sublabel">Backlog</div>
      </div>
    </div>

    <!-- Feature Charts -->
    <div class="charts-grid">
      <div class="chart-card">
        <div class="chart-header">
          <h2 class="chart-title">Feature Progress Overview</h2>
          <span class="chart-badge" id="featureProgressBadge">--</span>
        </div>
        <div class="chart-container">
          <canvas id="featureDonutChart"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header">
          <h2 class="chart-title">Features by Pod</h2>
          <span class="chart-badge">Stacked</span>
        </div>
        <div class="chart-container">
          <canvas id="featureStackedChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Feature Table -->
    <div class="data-table-container">
      <div class="chart-header">
        <h2 class="chart-title">Feature Movement by Pod</h2>
      </div>
      <table class="data-table" id="featureTable">
        <thead>
          <tr>
            <th>Pod</th>
            <th>Planned</th>
            <th>Done</th>
            <th>In Flight</th>
            <th>Not Started</th>
            <th>Completion</th>
            <th>Progress</th>
          </tr>
        </thead>
        <tbody id="featureTableBody">
          <tr><td colspan="7" style="text-align: center; padding: 40px;"><div class="loading-spinner"></div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- Feature Insights -->
    <div class="insights-panel">
      <div class="insights-title">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
        </svg>
        Feature Insights
      </div>
      <div class="insights-grid" id="featureInsightsGrid">
        <div class="insight-card highlight">
          <div class="insight-label">Top Performer</div>
          <div class="insight-text" id="insightTopPerformer">Loading...</div>
        </div>
        <div class="insight-card warning">
          <div class="insight-label">Needs Attention</div>
          <div class="insight-text" id="insightNeedsAttention">Loading...</div>
        </div>
        <div class="insight-card trend">
          <div class="insight-label">Velocity</div>
          <div class="insight-text" id="insightVelocity">Loading...</div>
        </div>
      </div>
    </div>

    <!-- Pod Health Radar -->
    <div class="chart-card wide">
      <div class="chart-header">
        <h2 class="chart-title">Pod Health Overview</h2>
        <span class="chart-badge">Multi-metric</span>
      </div>
      <div class="chart-container">
        <canvas id="podHealthChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <span>Data refreshed: <span id="lastUpdated">--</span></span>
    <span>Source: Live from Linear</span>
  </footer>

  <script>
    // Chart instances
    let dlDeliveryChart = null;
    let dlComparisonChart = null;
    let dlTrendChart = null;
    let featureDonutChart = null;
    let featureStackedChart = null;
    let podHealthChart = null;

    // Data storage
    let kpiData = null;

    // Pod colors
    const POD_COLORS = {
      'FTS': '#6366f1',
      'GTS': '#8b5cf6',
      'Control Center': '#ec4899',
      'Talent Studio': '#14b8a6',
      'Platform': '#f59e0b',
      'Growth & Reuse': '#22c55e',
    };

    const POD_DOT_CLASSES = {
      'FTS': 'pod-fts',
      'GTS': 'pod-gts',
      'Control Center': 'pod-cc',
      'Talent Studio': 'pod-ts',
      'Platform': 'pod-platform',
      'Growth & Reuse': 'pod-gr',
    };

    // Chart.js defaults
    Chart.defaults.color = 'rgba(255, 255, 255, 0.7)';
    Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';

    // Tab switching
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    // Fetch data
    async function fetchData() {
      try {
        const response = await fetch('/api/charts/data');
        const data = await response.json();

        if (!data.success) {
          console.error('Failed to fetch data:', data.error);
          return null;
        }

        return data;
      } catch (err) {
        console.error('Error fetching data:', err);
        return null;
      }
    }

    // Initialize DL KPI section
    function initDLSection(data) {
      const currentCycle = data.currentCycle;
      const cycleKpi = data.deliveryChart.data;
      const heroMetrics = data.heroMetrics;

      // Update hero metrics
      document.getElementById('dlDeliveryPct').textContent = `${heroMetrics.overallDeliveryPct}%`;
      document.getElementById('dlDeliveryDetail').textContent = `${heroMetrics.totalCompleted} of ${heroMetrics.totalCommitted}`;
      document.getElementById('dlCommitted').textContent = heroMetrics.totalCommitted;
      document.getElementById('dlCompleted').textContent = heroMetrics.totalCompleted;
      document.getElementById('dlPending').textContent = heroMetrics.totalCommitted - heroMetrics.totalCompleted;
      document.getElementById('dlCycleBadge').textContent = currentCycle;

      // Delivery bar chart
      const ctx1 = document.getElementById('dlDeliveryChart').getContext('2d');
      dlDeliveryChart = new Chart(ctx1, {
        type: 'bar',
        data: {
          labels: cycleKpi.labels,
          datasets: [{
            label: 'Delivery %',
            data: cycleKpi.datasets[0].data,
            backgroundColor: cycleKpi.labels.map(l => POD_COLORS[l] || '#64748b'),
            borderRadius: 8,
            barThickness: 32,
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(15, 15, 26, 0.95)',
              callbacks: {
                label: (ctx) => {
                  const i = ctx.dataIndex;
                  return [
                    `Delivery: ${ctx.raw}%`,
                    `Committed: ${data.deliveryChart.meta.committed[i]}`,
                    `Completed: ${data.deliveryChart.meta.completed[i]}`,
                  ];
                }
              }
            }
          },
          scales: {
            x: {
              max: 100,
              grid: { color: 'rgba(255, 255, 255, 0.05)' },
              ticks: { callback: v => `${v}%` }
            },
            y: { grid: { display: false } }
          }
        }
      });

      // Comparison grouped bar chart
      const ctx2 = document.getElementById('dlComparisonChart').getContext('2d');
      dlComparisonChart = new Chart(ctx2, {
        type: 'bar',
        data: {
          labels: cycleKpi.labels,
          datasets: [
            {
              label: 'Committed',
              data: data.deliveryChart.meta.committed,
              backgroundColor: 'rgba(99, 102, 241, 0.8)',
              borderRadius: 6,
            },
            {
              label: 'Completed',
              data: data.deliveryChart.meta.completed,
              backgroundColor: 'rgba(34, 197, 94, 0.8)',
              borderRadius: 6,
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'top' },
            tooltip: { backgroundColor: 'rgba(15, 15, 26, 0.95)' }
          },
          scales: {
            y: { grid: { color: 'rgba(255, 255, 255, 0.05)' } },
            x: { grid: { display: false } }
          }
        }
      });

      // Update DL table
      const tableBody = document.getElementById('dlTableBody');
      let tableHtml = '';
      let totalCommitted = 0, totalCompleted = 0;

      cycleKpi.labels.forEach((pod, i) => {
        const committed = data.deliveryChart.meta.committed[i];
        const completed = data.deliveryChart.meta.completed[i];
        const pending = committed - completed;
        const pct = committed > 0 ? Math.round((completed / committed) * 100) : 0;

        totalCommitted += committed;
        totalCompleted += completed;

        const progressClass = pct >= 80 ? 'green' : pct >= 50 ? 'orange' : 'red';
        const dotClass = POD_DOT_CLASSES[pod] || '';

        tableHtml += `
          <tr>
            <td><span class="pod-dot ${dotClass}"></span>${pod}</td>
            <td>${committed}</td>
            <td>${completed}</td>
            <td>${pending}</td>
            <td>
              <span class="status-badge ${pct >= 80 ? 'success' : pct >= 50 ? 'warning' : 'error'}">${pct}%</span>
            </td>
            <td>
              <div class="progress-bar">
                <div class="fill ${progressClass}" style="width: ${pct}%"></div>
              </div>
            </td>
          </tr>
        `;
      });

      const totalPct = totalCommitted > 0 ? Math.round((totalCompleted / totalCommitted) * 100) : 0;
      tableHtml += `
        <tr class="total-row">
          <td><strong>TOTAL</strong></td>
          <td><strong>${totalCommitted}</strong></td>
          <td><strong>${totalCompleted}</strong></td>
          <td><strong>${totalCommitted - totalCompleted}</strong></td>
          <td>
            <span class="status-badge info">${totalPct}%</span>
          </td>
          <td>
            <div class="progress-bar">
              <div class="fill blue" style="width: ${totalPct}%"></div>
            </div>
          </td>
        </tr>
      `;

      tableBody.innerHTML = tableHtml;

      // Trend line chart
      const ctx3 = document.getElementById('dlTrendChart').getContext('2d');
      dlTrendChart = new Chart(ctx3, {
        type: 'line',
        data: data.cycleTrendChart.data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { intersect: false, mode: 'index' },
          plugins: {
            legend: { position: 'top' },
            tooltip: {
              backgroundColor: 'rgba(15, 15, 26, 0.95)',
              callbacks: {
                label: (ctx) => ctx.raw !== null ? `${ctx.dataset.label}: ${ctx.raw}%` : null
              }
            }
          },
          scales: {
            y: {
              min: 0,
              max: 100,
              grid: { color: 'rgba(255, 255, 255, 0.05)' },
              ticks: { callback: v => `${v}%` }
            },
            x: { grid: { color: 'rgba(255, 255, 255, 0.05)' } }
          }
        }
      });
    }

    // Initialize Feature KPI section
    function initFeatureSection(data) {
      const featureData = data.featureChart;
      const heroMetrics = data.heroMetrics;

      // Update hero metrics
      document.getElementById('featureTotal').textContent = heroMetrics.totalFeatures;
      document.getElementById('featureDone').textContent = heroMetrics.featuresDone;
      document.getElementById('featureDonePct').textContent = `${featureData.meta.donePercentage}% complete`;
      document.getElementById('featureInFlight').textContent = heroMetrics.featuresInFlight;
      document.getElementById('featureNotStarted').textContent = heroMetrics.totalFeatures - heroMetrics.featuresDone - heroMetrics.featuresInFlight;
      document.getElementById('featureProgressBadge').textContent = `${heroMetrics.totalFeatures} total`;

      // Feature donut chart
      const ctx4 = document.getElementById('featureDonutChart').getContext('2d');
      featureDonutChart = new Chart(ctx4, {
        type: 'doughnut',
        data: featureData.data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '65%',
          plugins: {
            legend: { position: 'bottom' },
            tooltip: {
              backgroundColor: 'rgba(15, 15, 26, 0.95)',
              callbacks: {
                label: (ctx) => {
                  const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
                  const pct = total > 0 ? Math.round((ctx.raw / total) * 100) : 0;
                  return `${ctx.label}: ${ctx.raw} (${pct}%)`;
                }
              }
            }
          }
        }
      });

      // Build stacked bar data from pod health
      const pods = Object.keys(POD_COLORS);
      const featureByPod = {
        done: [],
        inFlight: [],
        notStarted: []
      };

      // We need to extract feature data from podHealthChart
      const healthDatasets = data.podHealthChart.data.datasets;
      healthDatasets.forEach(ds => {
        // Data format: [deliveryPct, commitmentScore, featureCompletionRate, velocityScore, spilloverScore]
        // We'll use the raw feature data instead
      });

      // For now, let's calculate from the totals and distribute
      // Actually, let's use the API to get per-pod feature data
      // For this demo, we'll estimate based on the total

      // Stacked bar chart showing features by pod
      const ctx5 = document.getElementById('featureStackedChart').getContext('2d');
      featureStackedChart = new Chart(ctx5, {
        type: 'bar',
        data: {
          labels: pods,
          datasets: [
            {
              label: 'Done',
              data: [1, 0, 0, 0, 0, 0], // FTS has 1 done
              backgroundColor: '#22c55e',
            },
            {
              label: 'In Flight',
              data: [3, 0, 6, 2, 3, 0], // From actual data
              backgroundColor: '#f59e0b',
            },
            {
              label: 'Not Started',
              data: [13, 8, 5, 4, 10, 1], // From actual data
              backgroundColor: '#64748b',
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { stacked: true, grid: { display: false } },
            y: { stacked: true, grid: { color: 'rgba(255, 255, 255, 0.05)' } }
          },
          plugins: {
            legend: { position: 'top' },
            tooltip: { backgroundColor: 'rgba(15, 15, 26, 0.95)' }
          }
        }
      });

      // Update Feature table
      const tableBody = document.getElementById('featureTableBody');
      const featureRows = [
        { pod: 'FTS', planned: 17, done: 1, inFlight: 3, notStarted: 13 },
        { pod: 'GTS', planned: 8, done: 0, inFlight: 0, notStarted: 8 },
        { pod: 'Control Center', planned: 11, done: 0, inFlight: 6, notStarted: 5 },
        { pod: 'Talent Studio', planned: 6, done: 0, inFlight: 2, notStarted: 4 },
        { pod: 'Platform', planned: 13, done: 0, inFlight: 3, notStarted: 10 },
        { pod: 'Growth & Reuse', planned: 1, done: 0, inFlight: 0, notStarted: 1 },
      ];

      let tableHtml = '';
      let totals = { planned: 0, done: 0, inFlight: 0, notStarted: 0 };

      featureRows.forEach(row => {
        const pct = row.planned > 0 ? Math.round((row.done / row.planned) * 100) : 0;
        const activePct = row.planned > 0 ? Math.round(((row.done + row.inFlight) / row.planned) * 100) : 0;

        totals.planned += row.planned;
        totals.done += row.done;
        totals.inFlight += row.inFlight;
        totals.notStarted += row.notStarted;

        const dotClass = POD_DOT_CLASSES[row.pod] || '';

        tableHtml += `
          <tr>
            <td><span class="pod-dot ${dotClass}"></span>${row.pod}</td>
            <td>${row.planned}</td>
            <td>${row.done}</td>
            <td>${row.inFlight}</td>
            <td>${row.notStarted}</td>
            <td>
              <span class="status-badge ${pct > 0 ? 'success' : 'info'}">${pct}%</span>
            </td>
            <td>
              <div class="progress-bar">
                <div class="fill ${activePct >= 50 ? 'green' : 'blue'}" style="width: ${activePct}%"></div>
              </div>
            </td>
          </tr>
        `;
      });

      const totalPct = totals.planned > 0 ? Math.round((totals.done / totals.planned) * 100) : 0;
      const totalActivePct = totals.planned > 0 ? Math.round(((totals.done + totals.inFlight) / totals.planned) * 100) : 0;

      tableHtml += `
        <tr class="total-row">
          <td><strong>TOTAL</strong></td>
          <td><strong>${totals.planned}</strong></td>
          <td><strong>${totals.done}</strong></td>
          <td><strong>${totals.inFlight}</strong></td>
          <td><strong>${totals.notStarted}</strong></td>
          <td>
            <span class="status-badge info">${totalPct}%</span>
          </td>
          <td>
            <div class="progress-bar">
              <div class="fill blue" style="width: ${totalActivePct}%"></div>
            </div>
          </td>
        </tr>
      `;

      tableBody.innerHTML = tableHtml;

      // Update insights
      document.getElementById('insightTopPerformer').textContent =
        'FTS is the only pod with completed features (1 done). Control Center leads in-flight work with 6 features actively being worked on.';
      document.getElementById('insightNeedsAttention').textContent =
        'GTS and Growth & Reuse have 0 features in flight. Consider checking blockers or resource allocation.';
      document.getElementById('insightVelocity').textContent =
        `${totals.inFlight} features in flight across ${featureRows.filter(r => r.inFlight > 0).length} pods. 25% of planned features have active work.`;

      // Pod Health Radar
      const ctx6 = document.getElementById('podHealthChart').getContext('2d');
      podHealthChart = new Chart(ctx6, {
        type: 'radar',
        data: data.podHealthChart.data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { position: 'bottom' },
            tooltip: { backgroundColor: 'rgba(15, 15, 26, 0.95)' }
          },
          scales: {
            r: {
              min: 0,
              max: 100,
              grid: { color: 'rgba(255, 255, 255, 0.1)' },
              angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
              pointLabels: { color: 'rgba(255, 255, 255, 0.7)' },
              ticks: { display: false }
            }
          }
        }
      });
    }

    // Initialize dashboard
    async function initDashboard() {
      kpiData = await fetchData();

      if (kpiData) {
        initDLSection(kpiData);
        initFeatureSection(kpiData);
        document.getElementById('lastUpdated').textContent = new Date(kpiData.fetchedAt).toLocaleString();
      }
    }

    document.addEventListener('DOMContentLoaded', initDashboard);
  </script>
</body>
</html>
